<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>日志管理</title>
    <style>
        th{
            display: inline-block;
        }
        td{
            display: inline-block;
        }
    </style>
    <link rel="stylesheet" href="../static/css/blog.css">
    <link rel="stylesheet" type="text/css" href="../static/css/style.css" />
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <script src="../static/js/sha1.min.js"></script>
    <script src="../static/js/sticky.min.js"></script>
    <script src="../static/js/vue.min.js"></script>
    <script src="../static/js/awesome.js"></script>
<script>

function initVM(data) {
    var vm = new Vue({
        el: '#vm',
        data: {
            blogs: data.blogs,
            page: data.page
        },
        methods: {
            edit_blog: function (blog) {
                location.assign('/blogs/edit?id=' + blog.id);
            },
            delete_blog: function (blog) {
                if (confirm('确认要删除“' + blog.name + '”？删除后不可恢复！')) {
                    postJSON('/api/blogs/' + blog.id + '/delete', function (err, r) {
                        if (err) {
                            return alert(err.message || err.error || err);
                        }
                        refresh();
                    });
                }
            }
        }
    });
    $('#vm').show();
}
$(function() {
   getJSON('/api/blogs',{
       page: {{page_index}}
       },function (err,results) {
        if(err){
            return fatal(err);
        }
        $('#loading').hide();
        initVM(results);
    });
});


</script>
</head>
<body id="botAgregar">
<script type="text/javascript">$.AutomLeafStart({leafsfolder:"../static/images/",howmanyimgsare:8,initialleafs:10,maxYposition:-10,multiplyclick:true,multiplynumber:2,infinite:true,fallingsequence:4000});$("#botAgregar").on("click",function(){$.AutomLeafAdd({leafsfolder:"../static/images/",add:8,})});</script>
<div class="layout" style="width:1400px; margin:auto; line-height:30px; margin-top:90px;">
<header>
    <div class="logo"></div>
    <div class="content">
        <div class="home">
            <a href="/">首页</a>
        </div>
        <div class="find">
            <a href="/">发现</a>
        </div>
        <div class="code">
            <a href="/">源码</a>
        </div>
    </div>
    {% if user %}
    <div class="person">
        <a>{{ user.name }}</a>
        <div style="margin-top: 3px; float: left">
                <img src="../static/img/person.png" width="20" height="20" >
        </div>
        <div class="person-content">
            <p><a href="/blogs/create">日志添加</a></p>
            <p><a href="/blogs">日志管理</a></p>
            <p><a href="/signout">退出登录</a></p>
        </div>
    </div>
    {% else %}
        <div class="person">
            <a href="/signin">登录</a>
        </div>
    {% endif %}
</header>
    <div style="background-color: white;border-radius: 10px;">
        <div style="margin-left: 20px;">
            <div>
                <h2>日志管理</h2>
            </div>
            <div id="vm">
                <div style="font-size: 19px;">
                    <a href="/blogs/create">新日志</a>
                    <div style="float: left;">
                        <img src="../static/img/plus.png" width="16" height="16">
                    </div>
                </div>
                <table style="margin-top: 20px;">
                    <thead>
                    <tr>
                        <th>标题/摘要</th>
                        <th style="margin-left: 300px;">作者</th>
                        <th style="margin-left: 300px;">创作时间</th>
                        <th style="margin-left: 300px;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-repeat="blog: blogs">
                        <td style="width: 200px;">
                            <a target="_blank" v-attr = "href: '/blog/'+blog.id" v-text="blog.name"></a>
                        </td>
                        <td style="margin-left: 173px; width: 200px;">
                            <a target="_blank" v-attr = "href: '/user/'+blog.user_id" v-text="blog.user_name"></a>
                        </td>
                        <td style="margin-left: 130px; width: 200px;">
                            <span v-text="blog.created_at.toDateTime()"></span>
                        </td>
                        <td style="margin-left: 163px; width: 200px;">
                            <a href="#0" v-on = "click: edit_blog(blog)"><img src="../static/img/edit.png" width="16" height="16"></a>
                            <a href="#0" v-on = "click: delete_blog(blog)"  style="margin-left: 5px;"><img src="../static/img/delete.png" width="16" height="16"></a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
<footer>
    <p>
        友情链接:
        <a href="https://github.com/Lvconl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../static/img/GitHub.png"></a>
        <a href="/">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../static/img/school.png"></a>
    </p>
    <p>Powered by <a href="mailto:835132735@qq.com">lvconl </a>Copyright @copy; 2018.</p>
    <a href="https://github.com/Lvconl" target="_blank">lvconl</a>.All right reserved.
</footer>
</div>
</body>
</html>