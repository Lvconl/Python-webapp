<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="../static/css/blog.css">
    <link rel="stylesheet" type="text/css" href="../static/css/style.css" />
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <script src="../static/js/sha1.min.js"></script>
    <script src="../static/js/sticky.min.js"></script>
    <script src="../static/js/vue.min.js"></script>
    <script src="../static/js/awesome.js"></script>
    <script>
        $(function () {
            var vm = new Vue({
                el: '#vm',
                data: {
                    name: '',
                    image:''
                },
                methods: {
                    submit: function (event) {
                        event.preventDefault();
                        var $form = $('#vm');
                        if (! this.name.trim()) {
                            alert('请输入用户名');
                            return;
                        }
                        $form.postJSON('/api/user_update', {
                            name: this.name.trim(),
                        }, function (err, r) {
                            if (err) {
                                //return alert(err);
                            }
                            alert('修改成功！');
                            return location.assign('/');
                        });
                    }
                }
            });
            $('#vm').show();
        });
    </script>
    <script>
        function imgPreview(fileDom){
            //判断是否支持FileReader
            if (window.FileReader) {
                var reader = new FileReader();
            } else {
                alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
            }

            //获取文件
            var file = fileDom.files[0];
            var imageType = /^image\//;
            //是否是图片
            if (!imageType.test(file.type)) {
                alert("请选择图片！");
                return;
            }
            //读取完成
            reader.onload = function(e) {
                //获取图片dom
                var img = document.getElementById("preview");
                //图片路径设置为读取的图片
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    </script>
</head>
<body id="botAgregar">
<script type="text/javascript">$.AutomLeafStart({leafsfolder:"../static/images/",howmanyimgsare:8,initialleafs:10,maxYposition:-10,multiplyclick:true,multiplynumber:2,infinite:true,fallingsequence:4000});$("#botAgregar").on("click",function(){$.AutomLeafAdd({leafsfolder:"../static/images/",add:8,})});</script>
<div class="layout" style="width:1400px; margin:auto; line-height:30px; margin-top:90px;">
<header>
    <div class="logo"></div>
    <div class="content">
        <div class="home">
            <a href="/">首页</a>
        </div>
        <div class="find">
            <a href="https://github.com/">发现</a>
        </div>
        <div class="code">
            <a href="https://github.com/Lvconl/Python-webapp/tree/version.2">源码</a>
        </div>
    </div>
    {% if user %}
    <div class="person">
        <a>{{ user.name }}</a>
        <div style="margin-top: 3px; float: left">
                <img src="../static/img/person.png" width="20" height="20" >
        </div>
        <div class="person-content" style="font-size: 19px;">
            {% if user.admin == 1 %}
            <p><a href="/blogs/create"><img src="../static/img/plus.png" width="16" height="16">日志添加</a></p>
            <p><a href="/blogs"><img src="../static/img/setting.png" width="16" height="16">日志管理</a></p>
            {% endif %}
            <p><a href="/user/edit"><img src="../static/img/info.png" height="16" width="16">修改昵称</a>
            <p><a href="/signout"><img src="../static/img/exit.png" width="16" height="16">退出登录</a></p>
        </div>
    </div>
    {% else %}
        <div class="person">
            <a href="/signin">登录</a>
        </div>
    {% endif %}
</header>
<div class="person_info" style="background-color: white;border-radius: 10px;">
        <div style="margin-left: 20px;">
            <header>
                <h3>个人信息</h3>
            </header>
            <div>
                <form id="vm" v-on="submit: submit">
                    <div>
                    <label>账号创建时间:{{ user.created_at|datetime }}</label>
                    </div>
                    <label>邮箱账号<label style="color: red;">(此账号为您注册账号，不可修改)</label>:</label>
                    <div>
                        <input v-model="email" name="email" type="email" value="{{ user.email }}" disabled="disabled">
                    </div>
                    <label>用户名:</label>
                    <div>
                        <input v-model="name" name="name" type="text" placeholder="用户名" value="{{ user.name }}">
                    </div>
                    <label>个人头像（修改头像功能正在维护）:</label>
                    <div>
                        <img id="preview" width="100px" height="100px" src="{{ user.image }}">
                    </div>
                    <div>
                        <button type="submit" style="border-radius: 5px; border: none;background-color: #0f88eb;color: white;font-size: 16px;margin-top: 10px;margin-bottom: 10px;">确认修改</button>
                        <a href="/" style="margin-left: 10px;font-size: 16px;">取消</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
<footer>
    <p>
        友情链接:
        <a href="https://github.com/Lvconl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../static/img/GitHub.png"></a>
        <a href="/">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../static/img/school.png"></a>
    </p>
    <p>Powered by <a href="mailto:835132735@qq.com">lvconl </a>Copyright @copy; 2018.</p>
    <a href="https://github.com/Lvconl" target="_blank">lvconl</a>.All right reserved.
</footer>
</div>
</body>
</html>